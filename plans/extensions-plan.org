#+TITLE: Extensions Architecture
#+AUTHOR: OrgNote
#+DATE: 2025-12-01



* Storage architecture
[[excalidraw:./bb20d49e-3913-44a0-b6d6-27c62532d308.excalidraw.svg]]

** Extension repository structure
Indexeddb stored structure (inmemory)
#+BEGIN_SRC typescript-ts
interface ExtensionSource {
    name: string;
    version: string;
    source: string;
    module: string;
    docFiles: string[];
    hash: string;
}
#+END_SRC

#+BEGIN_SRC typescript-ts
interface ExtensionSourceRepository {
  getAll(): Promise<ExtensionSource[]>;
  save(source: ExtensionSource): Promise<void>;
  delete(name: string): Promise<void>;
  upsert(source: ExtensionSource): Promise<void>;
}
#+END_SRC

** Extension storage
Meta info:
#+BEGIN_SRC typescript-ts
export interface ExtensionMeta {
  manifest: ExtensionManifest;
  uploaded?: boolean;
  active?: boolean;
  config?: Record<string, unknown>;
}
#+END_SRC

#+BEGIN_SRC typescript-ts
export interface ExtensionStore {
  extensions: Ref<ExtensionMeta[]>;

  /** Read extensions from file system **/
  sync: () => Promise<void>;
  init: () => Promise<void>;

  enableExtension: (extensionName: string) => Promise<void>;
  disableExtension: (extensionName: string) => Promise<void>;

  enableSafeMode: () => Promise<void>;
  disableSafeMode: () => Promise<void>;

  isExtensionExist: (extensionName: string) => boolean;

  addExtension: (ext: ExtensionMeta) => void;
  deleteExtension: (ext: ExtensionMeta) => Promise<void>;
}
#+END_SRC



* File system update
#+BEGIN_SRC mermaid
#+END_SRC

[[excalidraw:./4ba38c4f-6361-48ce-9300-6ce28a749972.excalidraw.svg]]
